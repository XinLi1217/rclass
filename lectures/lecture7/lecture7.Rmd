---
title: Joining multiple datasets
subtitle:  Lecture 7
author: Ozan Jaquette
date: 
output: 
  html_document:
    toc: true
    toc_depth: 2
    toc_float: # toc_float option to float the table of contents to the left of the main document content. floating table of contents will always be visible even when the document is scrolled
      collapsed: false # collapsed (defaults to TRUE) controls whether the TOC appears with only the top-level (e.g., H2) headers. If collapsed initially, the TOC is automatically expanded inline when necessary
      smooth_scroll: true # smooth_scroll (defaults to TRUE) controls whether page scrolls are animated when TOC items are navigated to via mouse clicks
    number_sections: true
    fig_caption: true # ? this option doesn't seem to be working for figure inserted below outside of r code chunk    
    highlight: default # Supported styles include "default", "tango", "pygments", "kate", "monochrome", "espresso", "zenburn", and "haddock" (specify null to prevent syntax    
    theme: default # theme specifies the Bootstrap theme to use for the page. Valid themes include default, cerulean, journal, flatly, readable, spacelab, united, cosmo, lumen, paper, sandstone, simplex, and yeti.
    df_print: tibble #options: default, tibble, paged
    keep_md: true # may be helpful for storing on github
    
---

```{r, echo=FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>", highlight = TRUE)
```

# Introduction

Rare for an analysis dataset to consist of data from only one input dataset. For most projects, each analysis dataset contains data from multiple data sources. Therefore, you must become proficient in combining data from multiple data sources.

Two broad topics today:

1. __Joining__ datasets [big topic]
    - Combine two datasets so that the resulting dataset has additional variables
    - The term "join" comes from the relational databases world; Social science research often uses the term "merge" rather than "join"
2. __Appending__ datasets  [small topic]
    - Stack datasets on top of one another so that resulting dataset has more observations, but (typically) the same number of variables
    - Often, longitudinal datasets are created by appending datasets


Libraries we will use
```{r}
library(tidyverse)
```

## NLS72 data

Today's lecture will utilize several datasets from the National Longitudinal Survey of 1972 (NLS72)
- Student level dataset
- Student-transcript level dataset
- Student-transcript-term level dataset
- Student-transcript-term-course level dataset

These datasets good for teaching "joining" because you get practice joining data sources with different "observational levels" (e.g., join student level and student-transcript level data)

Student level data
```{r}
rm(list = ls()) # remove all objects

getwd()
nls_stu_big <- read_dta(file="../../data/nls72/nls72stu_percontor_vars.dta")

#names(nls_stu_big)
#nls_stu_big %>% var_label()

#create subset of data
nls_stu <- nls_stu_big %>% select(id,schcode,bysex,csex,crace,cbirthm,cbirthd,cbirthyr)

str(nls_stu$bysex)
nls_stu %>% select(bysex) %>% var_label()
nls_stu %>% select(bysex) %>% val_labels()
nls_stu %>% select(bysex) %>% count(bysex)
nls_stu %>% select(bysex) %>% count(bysex) %>% as_factor()
```

Student-transcript level data
```{r}
nls_tran_big <- read_dta(file="../../data/nls72/nls72petstrn_v2.dta")

names(nls_tran_big)
nls_tran_big %>% var_label()

nls_tran <- nls_tran_big %>% select(id,transnum,findisp,trnsflag,terms,fice,state,cofcon,instype,itype)
```

Student-transcript-term level data
```{r}
nls_term <- read_dta(file="../../data/nls72/nls72petstrm_v2.dta")
```

Student-transcript-term-course level data
```{r}
nls_course <- read_dta(file="../../data/nls72/nls72petscrs_v2.dta")
```

# Keys

# Mutating joins

# Filtering joins

# Appending/stacking data
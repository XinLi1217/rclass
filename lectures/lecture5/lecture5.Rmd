---
title: Managing and Manipulating Data Using R # potentially push to header
subtitle:  Lecture 5, Survey data and exploratory data analysis (for data quality)
author: Ozan Jaquette
date: 
fontsize: 8pt
classoption: dvipsnames  # for colors
output:
  beamer_presentation:
    keep_tex: true
    toc: true
    slide_level: 3
    theme: default # AnnArbor # push to header?
    #colortheme: "dolphin" # push to header?
    #fonttheme: "structurebold"
    highlight: default # Supported styles include "default", "tango", "pygments", "kate", "monochrome", "espresso", "zenburn", and "haddock" (specify null to prevent syntax highlighting); push to header
    df_print: default #default # tibble # push to header?    
    latex_engine: xelatex #  Available engines are pdflatex [default], xelatex, and lualatex; The main reasons you may want to use xelatex or lualatex are: (1) They support Unicode better; (2) It is easier to make use of system fonts.
    includes:
      in_header: ../beamer_header.tex
      #after_body: table-of-contents.txt 
---

<!-- CAN THIS BE MOVED TO SOME KIND OF HEADER FILE? --> 

```{r, echo=FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>", highlight = TRUE)
#knitr::opts_chunk$set(collapse = TRUE, comment = "#>", highlight = TRUE)
  #comment = "#>" makes it so results from a code chunk start with "#>"; default is "##"
```

# Introduction

### Libraries we will use today [install if you don't have them]

```{r}
library(tidyverse)
library(haven)
library(labelled)
```

### Data we will use today

High school longitudinal surveys from National Center for Education Statistics (NCES)

- Follow U.S. students from high school through college, labor market

We will be working with [High School Longitudinal Study of 2009 (HSLS:09)](https://nces.ed.gov/surveys/hsls09/index.asp)

- Follows 9th graders from 2009
- Data collection waves
      - Base Year (2009)
      - First Follow-up (2012)
      - 2013 Update (2013)
      - High School Transcripts (2013-2014)
      - Second Follow-up (2016)    
 

# `haven` and `labelled` package

### `haven` package

[`haven`](https://haven.tidyverse.org/), which is part of __tidyverse__, "enables R to read and write various data formats" from the following statistical packages: 

- SAS
- SPSS
- Stata

When using `haven` to read data, resulting R objects have these characteristics:

- Are __tibbles__, a particular type of data frame we discuss future weeks
- Transform variables with "value labels" into the `labelled()` class [our focus today]
    - Helpful description [HERE](https://haven.tidyverse.org/articles/semantics.html)
- Dates and times converted to R date/time classes
- Character vectors not converted to factors

### `haven` package

Use `read_dta()` function from `haven` to import Stata dataset into R
```{r, results="hide"}
hsls <- read_dta(file="../../data/hsls/hsls_stu_small.dta")
```

Let's examine the data
```{r, results="hide"}
names(hsls)
names(hsls) <- tolower(names(hsls)) # convert names to lowercase
str(hsls)
str(hsls$s3classes)
```

### `labelled` package

`labelled` package is to work with data imported from SPSS/Stata/SAS using the `haven` package. 

- Specifically, "The purpose of the `labelled` package is to provide functions to manipulate _metadata_ as variable labels, value labels and defined missing values using the `labelled class` and the `label` attribute introduced in `haven` package. [LINK](https://cran.r-project.org/web/packages/labelled/vignettes/intro_labelled.html)

Functions in `labelled` package

- [Full list](https://www.rdocumentation.org/packages/labelled/versions/1.1.0)
- A couple relevant functions
    - `val_labels`: get or set variable _value labels_
    - `var_label`: get or set a _variable label_

```{r, results="hide"}
hsls %>% select(s3classes) %>% var_label
hsls %>% select(s3classes) %>% val_labels
```
### Understanding `labelled` data

First, let's review core concepts:

__atomic vectors (and lists)__ the underlying data

- data structures: vector or list
- data type: numeric (integer or double); character; logical
```{r}
typeof(hsls$s3classes)
```

__augmented vectors__ are atomic vectors with __attributes__ attached

__attributes__ are "metadata" attached to an object. Examples

- __names__: names of elements of a vector or list (e.g., variable names)
- __levels__: display output associated with values of a factor variable
- __class__: e.g., factor, labelled

```{r, results="hide"}
attributes(hsls$s3classes)
```
__class__ is an object oriented programming concept. The `class` of an object determines which functions can be applied to the object and what those functions do

- e.g., can't apply `sum()` to an object where `class=character`

### Understanding `labelled` data

Let's investigate the attributes of `hsls$s3classes`

```{r, results="hide"}
typeof(hsls$s3classes)
class(hsls$s3classes)

str(hsls$s3classes)
attributes(hsls$s3classes)

#use attr(object_name,"attribute_name") to refer to each attribute
attr(hsls$s3classes,"label")
attr(hsls$s3classes,"labels")
attr(hsls$s3classes,"class")
attr(hsls$s3classes,"format.stata")
```

### Understanding `labelled` data

What is `class==labelled`?

- An object class created by the `haven` package for importing variables from SAS/SPSS/Stata that have __value labels__
- __value labels__ [in Stata] are labels attached to specific values of a variable:
    - e.g., variable value `1` attached to value label "married", `2`="single", `3`="divorced"
- Variables in an R data frame with `class==labelled`:
    - data `type` can be numeric(double) or character
    - The `value labels` associated with each value:
        `attr(data_frame_name$variable_name,"labels")`
    - In `filter()` refer to variable value, not the value label
    
Working with `class==labelled` variables
```{r, results="hide"}
#show variable label
hsls %>% select(s3classes,s3clglvl) %>% var_label
#show value labels
hsls %>% select(s3classes,s3clglvl) %>% val_labels
#Frequency table
hsls %>% select(s3classes) %>% count(s3classes)
#Frequency table, value labels instead of variable values
hsls %>% select(s3classes) %>% count(s3classes) %>% as_factor()
#in filters, refer to variable value, not value label
hsls %>% select(s3classes) %>% filter(s3classes==-8) %>% count(s3classes)
```

### Converting `class==labelled` to `class==factor`

The `as_factor()` function from `haven` package converts variables with `class==labelled` to `class==factor`

- Can be used for descriptive statistics
```{r, results="hide"}
hsls %>% select(s3classes) %>% count(s3classes) %>% as_factor()
```

- Can create object with some or all `labelled` vars converted to `factor`
```{r}
hsls_f <- as_factor(hsls,only_labelled = TRUE)
```

Let's examine this object
```{r, results="hide"}
glimpse(hsls_f)
hsls_f %>% select(s3classes,s3clglvl) %>% str()
typeof(hsls_f$s3classes)
class(hsls_f$s3classes)
attributes(hsls_f$s3classes)

hsls_f %>% select(s3classes) %>% var_label()
hsls_f %>% select(s3classes) %>% val_labels()
```

### Working with `class==factor` data

Showing values associated with factor levels
```{r}
hsls_f %>% select(s3classes) %>% count(s3classes)
```

In code, refer `level` attribute not variable value
```{r}
hsls_f %>% select(s3classes) %>% filter(s3classes=="Yes") %>% count(s3classes)
```

### Comparing `class==labelled` to `class==factor`

|  | `class==labelled` | `class==factor`
|---|----------|-------------|
| data type  |    numeric or character   | integer |
| name of value label attribute | labels | levels |
| refer to data using | variable values | levels attribute |


# Exploratory data analysis (EDA)

## Tools for EDA

### What is exploratory data analysis (EDA)?

The [Towards Data Science](https://towardsdatascience.com/exploratory-data-analysis-8fc1cb20fd15) website has a nice definition of EDA:

> "Exploratory Data Analysis refers to the critical process of performing initial investigations on data so as to discover patterns,to spot anomalies,to test hypothesis and to check assumptions with the help of summary statistics and graphical representations." 

This course focuses on "data management": 

- investigating and cleaning data for the purpose of creating analysis variables
- Basically, everything that happens before you conduct analyses

I think about "Exploratory data analysis for data quality"

- Investigating values and patterns of variables from "input data"
- Identifying and cleaning errors or values that need to be changed
- Creating analysis variables
- Checking values of analysis variables agains values of input variables

### Tools of EDA

To do EDA for data quality, must master the following tools:

- \medskip Select, sort, filter, and print
    - Select and sort particular values of particular variables
    - Print particular values of particular variables
- One-way descriptive analyses (i.e,. focus on one variable)
    - Descriptive analyses for continuous variables
    - Descriptive analyses for discreet/categorical variables
- Two-way descriptive analyses (relationship between two variables)
    - Categorical by categorical
    - Categorical by continuous
    - Continuous by continuous

Whenever using any of these tools, __pay close attention to missing values and how they are coded__

I'll focus on the __tidyverse__ approach rather than __base R__

### Tools of EDA: select, sort, filter, and print

Let's create a smaller version of the HSLS:09 dataset
```{r}
hsls %>% var_label()
hsls_small <- hsls %>% select(stu_id,x3univ1,x3sqstat,x4univ1,x4sqstat,s3classes,s3work,s3focus,
  s3clgft,s3workft,s3clgid,s3clgcntrl,s3clglvl,s3clgsel,s3clgstate,s3proglevel,
  x4evrappclg,x4evratndclg,x4atndclg16fb,x4ps1sector,x4ps1level,x4ps1ctrl,x4ps1select,
  x4refsector,x4reflevel,x4refctrl,x4refselect,
  x2sex,x2race,x2paredu,x2txmtscor,x4x2ses,x4x2sesq5)
```

### Tools of EDA: select, sort, filter, and print

We've already know `select()`, `arrange()`, `filter()` 

\medskip Select, sort, and print specific vars
```{r, results="hide"}
hsls_small %>% arrange(desc(stu_id)) %>% 
  select(stu_id,x3univ1,x3sqstat,s3classes,s3clglvl)

#print value labels
hsls_small %>% arrange(desc(stu_id)) %>% 
  select(stu_id,x3univ1,x3sqstat,s3classes,s3clglvl) %>% as_factor()
```
Sometimes helpful to increase the number of observations printed
```{r, results="hide"}
class(hsls_small) #it's a tibble
options(tibble.print_min=50) 
# execute this in console
hsls_small %>% arrange(desc(stu_id)) %>% select(stu_id,x3univ1,x3sqstat,s3classes,s3clglvl)
options(tibble.print_min=10) # set default printing back to 10 lines
```

### One-way descriptive stats for continuous vars, Base R approach [SKIP]

```{r, results="hide"}
mean(hsls_small$x2txmtscor)
sd(hsls_small$x2txmtscor)

#Careful: summary stats include value of -8!
min(hsls_small$x2txmtscor)
max(hsls_small$x2txmtscor)
```
Be careful with `NA` values
```{r, results="hide"}
#Create variable replacing -8 with NA
hsls_small_temp <- hsls_small %>% 
  mutate(x2txmtscorv2=ifelse(x2txmtscor==-8,NA,x2txmtscor))
hsls_small_temp %>% filter(is.na(x2txmtscorv2)) %>% count(x2txmtscorv2)

mean(hsls_small_temp$x2txmtscorv2)
mean(hsls_small_temp$x2txmtscorv2, na.rm=TRUE)
rm(hsls_small_temp)
```
### One-way descriptive stats for continuous vars, Tidyverse approach

Use `summarise_at()` which is a variation of `summarise()` to calculate descriptive stats

- explain `.args=list(na.rm=TRUE)` on next slide

```{r, results}
?summarise_at
hsls_small %>% 
  summarise_at(
    .vars = vars(x2txmtscor),
    .funs = funs(mean, sd, min, max, .args=list(na.rm=TRUE))
  )
```

### One-way descriptive stats for continuous vars, Tidyverse approach

"Input vars" in survey data often have negative values for missing/skips

- R includes those negative values when calculating statistics, which you probably don't want

Solution: create version of variable that replaces negative values with NAs
```{r}
hsls_small %>% mutate(x2txmtscor_na=ifelse(x2txmtscor<0,NA,x2txmtscor)) %>%
  summarise_at(
    .vars = vars(x2txmtscor_na),
    .funs = funs(mean, sd, min, max, .args=list(na.rm=TRUE))
  )
```
What if you didn't include `.args=list(na.rm=TRUE)`?
```{r}
hsls_small %>% mutate(x2txmtscor_na=ifelse(x2txmtscor<0,NA,x2txmtscor)) %>%
  summarise_at(
    .vars = vars(x2txmtscor_na),
    .funs = funs(mean, sd, min, max)
  )
```


### One-way descriptive stats for continuous vars, Tidyverse approach

How to identify these missing/skip values if you don't have a codebook?

`count()` combined with `filter()` helpful for finding extreme values of continuous vars, which are often associated with missing or skip

```{r}
hsls_small %>% filter(x2txmtscor<0) %>% count(x2txmtscor)

hsls_small %>% filter(s3clglvl<0) %>% count(s3clglvl)
```

### Student exercise

### One-way descriptive stats for discrete/categorical vars, Tidyverse approach

Use `count()` to investigate values of discreet or categorical variables

For variables where `class==labelled`
```{r, results="hide"}
class(hsls_small$s3classes)
#show counts of variable values
hsls_small %>% count(s3classes)
#show counts of value labels
hsls_small %>% count(s3classes) %>% as_factor()
```

- I like `count()` because the default setting is to show `NA` values too!
```{r, results="hide"}
hsls_small %>% mutate(s3classes_na=ifelse(s3classes<0,NA,s3classes)) %>% 
  count(s3classes_na)
```

Show both values and value labels on count tables for `class==labelled`
```{r, results="hide"}
#CRYSTAL'S SOLUTION
x <- hsls_small %>% count(s3classes)
y <- hsls_small %>% count(s3classes) %>% as_factor()
bind_cols(x[,1], y)
```

### One-way descriptive stats for discrete/categorical vars, Tidyverse approach

For variables where `class==factor` 
[PROBLEM: HOW TO RETAIN FACTOR LEVELS AFTER MUTATE]
```{r, results="hide"}
#use variable from the hsls data frame where vars are factors
class(hsls_f$s3classes)
attributes(hsls_f$s3classes)

#show frequency table
hsls_f %>% count(s3classes)
#frequency table with NAs
  #note: within ifelse() used levels(s3classes)[s3classes]) rather than s3classes  to show attribute levels not values
hsls_f %>% mutate(s3classes_f=ifelse(s3classes %in% c("Missing","Unit non-response"),NA,levels(s3classes)[s3classes])) %>% 
  count(s3classes_f)
```


### Relationship between variables, categorical by categorical

Two-way frequency table, sometimes called "Cross tabulation", is important for checking data quality
- When you create categorical analysis var from single categorical "input" var
    - Two-way tables show us whether we did this correctly
- Two-way tables helpful for understanding skip patterns in surveys

Task: Create a two-way table between `s3classes` and `s3clglvl`
```{r, results="hide"}
hsls_small %>% select(s3classes,s3clglvl) %>% var_label()

hsls_small %>% group_by(s3classes) %>% count(s3clglvl)
hsls_small %>% group_by(s3classes) %>% count(s3clglvl) %>% as_factor()
```
What if one of the variables has `NAs`?

- Table created by `group_by()` and `count()` shows `NAs`!
```{r, results="hide"}
hsls_small %>% select(s3classes,s3clglvl) %>%
  mutate(s3classes_na=ifelse(s3classes<0,NA,s3classes)) %>%
  group_by(s3classes_na) %>% count(s3clglvl)

hsls_small %>% select(s3classes,s3clglvl) %>%
  mutate(s3classes_na=ifelse(s3classes<0,NA,s3classes),
         s3clglvl_na=ifelse(s3clglvl==-7,NA,s3clglvl)) %>%
  group_by(s3classes_na) %>% count(s3clglvl_na)
```
### Relationship between variables, categorical by categorical

Tables above are pretty ugly

Use the `spread()` function from `tidyr` package to create table with one variable as columns and the other variable as rows

- The variable you place in `spread()` will be columns

```{r, results="hide"}
hsls_small %>% group_by(s3classes) %>% count(s3clglvl) %>% 
  spread(s3classes, n)

hsls_small %>% group_by(s3classes) %>% count(s3clglvl) %>% 
  as_factor() %>%  spread(s3classes, n)
hsls_small %>% group_by(s3classes) %>% count(s3clglvl) %>% 
  as_factor() %>%  spread(s3clglvl, n)
```

### Relationship between variables, categorical by continuous

Investigating relationship between multiple variables is a little tougher when at least one of the variables is continuous

One approach is the __conditional mean__:

- Shows average values of continous variables within groups
- Groups are defined by your categorical variable(s)

Relationship to regression

- Conditional mean is similar to regression with a continuous dependent variable and a categorical X variable

Task: 

- Investigate the relationship between math test score, `x2txmtscor`, and parental education, `x2paredu`

```{r, results="hide"}
#first, investigate parental education
hsls_small %>% count(x2paredu)
hsls_small %>% count(x2paredu) %>% as_factor

## using dplyr to get average math score by parental education level
hsls_small %>%
    group_by(x2paredu) %>%
    summarise_at(.vars = vars(x2txmtscor),
                 .funs = funs(mean, .args = list(na.rm = TRUE))) %>%
    as_factor()
```

### Relationship between variables, categorical by continuous

Task: Investigate the relationship between math test score, `x2txmtscor`, and parental education, `x2paredu`

For checking data quality, helpful to calculate other stats besides mean
```{r, results="hide"}
hsls_small %>% group_by(x2paredu) %>%
    summarise_at(.vars = vars(x2txmtscor),
                 .funs = funs(mean, min, max, .args = list(na.rm = TRUE))) %>%
    as_factor()

```
Always Investigate presence of missing/skip values
```{r, results="hide"}
hsls_small %>% filter(x2paredu<0) %>% count(x2paredu)
hsls_small %>% filter(x2txmtscor<0) %>% count(x2txmtscor)
```

Replace `-8` with `NA` and re-calculate conditional stats
```{r, results="hide"}
hsls_small %>% select(x2paredu,x2txmtscor) %>%
  mutate(x2paredu_na=ifelse(x2paredu<0,NA,x2paredu),
         x2txmtscor_na=ifelse(x2txmtscor<0,NA,x2txmtscor)) %>% 
  group_by(x2paredu_na) %>%
  summarise_at(.vars = vars(x2txmtscor_na),
               .funs = funs(mean, min, max, .args = list(na.rm = TRUE))) %>%
  as_factor()
```
### Relationship between variables, categorical by continuous

[MAKE THIS A STUDENT EXERCISE?]

Can use same approach to calculate conditional mean by multiple `group_by()` variables

- Just add additional variables within `group_by()`

Task: Calculate mean math test score (`x2txmtscor`), for each combination of parental education (`x2paredu`) and sex (`x2sex`)

```{r, results="hide"}
hsls_small %>%
    group_by(x2paredu,x2sex) %>%
    summarise_at(.vars = vars(x2txmtscor),
                 .funs = funs(mean, .args = list(na.rm = TRUE))) %>%
    as_factor()
```
## Guidelines for EDA

### Guidelines for "EDA for data quality"

Assme that your goal in "EDA for data quality" is to investigate "input" data sources and create "analysis variables"

- Usually, your analysis dataset will incorporate multiple sources of input data, including data you collect (primary data) and/or data collected by others (secondary data)

While this is not a linear process, these are the broad steps I follow 

1. Understand how inout data sources were created
    - e.g., when working with survey data, have survey questionnaire and codebooks on hand
1. For each input data source, identify the "unit of analysis" and which combination of variables uniquely identify observations
1. Investigate patterns in input variables
1. Create analysis variable from input variable(s)
1. Verify that analysis variable is created correctly through descriptive statistics that compare values of input variable(s) against values of the analysis variable

__Always be aware of missing values__

### "Unit of analysis" and which variables uniquely identify observations

"Unit of analysis" refers to "what does each observation represent" in an input data source

- If each obs represents a student, you have "student level data"
- If each obs represents a student-course, you have "student-course level data"
- If each obs represents a school, you have "school-level data"
- If each obs represents a school-year, you have "school-year level data"

How to identify unit of analysis

- data documentation
- investigating the data set

### "Unit of analysis" and which variables uniquely identify observations

Identify the variable -- or group of vars -- that "uniquely identifies" observations

- "uniquely identifies observations": each value of the var has a frequency count of `1`

This is important for many data management tasks

- e.g., merging data sources, "tidying" data

How to identify which variable(s) uniquely identify observations

- data documentation
- investigating the data set

```{r}
hsls_small %>% group_by(stu_id) %>% # group_by our candidate
  mutate(n_per_id=n()) %>% # calculate number of obs per group
  ungroup() %>% # ungroup the data
  count(n_per_id==1) # count "true that only one obs per group"

#hsls_small %>% count(stu_id) %>% filter(n> 1) ## Patricia's approach
#Karina approaches using asserthat package
#library(assertthat)
#stopifnot(length(unique(uga_pub$ncessch))==nrow(uga_pub))
#assert_that(any(duplicated(uga_pub, by=c("ncessch", "var2")))==FALSE)
```

### Rules for variable creation

Rules I follow for variable creation

1. \medskip Never modify "input variable"; instead create new variable based on input variable(s)
    - Always keep input variables used to create new variables
1. Investigate input variable(s) and relationship between input variables
1. Developing a plan for creation of analysis variable
    - e.g., for each possible value of input variables, what should value of analysis variable be?
1. Write code to create analysis variable
1. Run descriptive checks to verify new variables are constructed correctly
    - Can "comment out" these checks, but don't delete them
1. Document new variables with notes and labels

### Rules for variable creation

Task: Create analysis fir ses qunitile called `sesq5` based on `x4x2sesq5`

```{r, results="hide"}
#investigate input variable
hsls_small %>% select(x4x2sesq5) %>% var_label()
hsls_small %>% select(x4x2sesq5) %>% val_labels()
hsls_small %>% select(x4x2sesq5) %>% count(x4x2sesq5)
hsls_small %>% select(x4x2sesq5) %>% count(x4x2sesq5) %>% as_factor()

#create analysis variable
hsls_small_temp <- hsls_small %>% 
  mutate(sesq5=ifelse(x4x2sesq5==-8,NA,x4x2sesq5)) # approach 1
hsls_small_temp <- hsls_small %>% 
  mutate(sesq5=ifelse(x4x2sesq5<0,NA,x4x2sesq5)) # approach 1

#verify
hsls_small_temp %>% group_by(x4x2sesq5) %>% count(sesq5)
```
### How to be a good researcher, good research assistant (RA) [CUT?]

[keep or cut this section?]
[hidden curriculum stuff; look at notes from last time you taught Stata data mgt]

- Your advisor/PI getting $ to support students depends on previous RAs doing a good job
- Must master certain skills, but beyond that it is mindset and approach that matters

## Skip patterns

### What are skip patterns

Pretty easy to create an analysis variable based on a single input variable

Harder to create analysis variables based on multiple input variables

- When working with survey data, even seemingly simple analysis variables require multiple input variables due to "skip patterns"

What are "skip patterns"? [students answer]

- [?DELETE OR DELAY?] Response on a particular survey item determines whether respondent answers some set of subsequent questions
- What are some examples of this?

Key to working with skip patterns

- Have the survey questionnaire on hand
- Sometimes it appears that analysis variable requires only one input variable, but really depends on several input variables because of skip patterns
    - Don't just blindly turn "missing" and "skips" from survey data to `NAs` in your analysis variable
    - Rahter, trace why these "missing" and "skips" appear and decide how they should be coded in your analysis variable


### Creating analysis variables in the presence of skip patterns

Task: Create a measure  of "level" of postsecondary institution attended in 2013 from HSLS:09 survey data

- "level" is highest award-level of the postsecondary institution
    - e.g., if highest award is associate's degree (a two-year degree), then `level==2'
- The measure, `pselev2013`, should have following [non-missing] values:
    1. Not attending postsecondary education institution
    2. Attending a 2-year or less-than-2-year institution
    3. Attending 4-year or greater-than-4year institution

Background info:

- In "2013 Update" of HSLS:09, students asked about college attendance
    - Variables from student responses to "2013 Update" have prefix `s3`
- Survey questionnaire for 2013 update can be found [HERE](https://nces.ed.gov/surveys/hsls09/pdf/2013_Student_Parent_Questionnaire.pdf)
- The "online codebook" website [HERE](https://nces.ed.gov/onlinecodebook) has info about specific variables
- Measure has 3 input variables [usually must figure this out yourself]:
    1. `x3sqstat`: "X3 Student questionnaire status"
    1. `s3classes`: "S3 B01A Taking postsecondary classes as of Nov 1 2013"
    1. `s3clglvl`: "S3 Enrolled college IPEDS level"

```{r, results="hide"}
hsls_small %>% select(x3sqstat,s3classes,s3clglvl) %>% var_label()
```
You won't have time to complete this task, but develop a plan for the task and get as far as you can

### Creating analysis variables in the presence of skip patterns

Step 1a: Investigate each input variable separately
```{r, results="hide"}
#variable labels
hsls_small %>% select(x3sqstat,s3classes,s3clglvl) %>% var_label()

hsls_small %>% count(x3sqstat)
hsls_small %>% count(x3sqstat) %>% as_factor()

hsls_small %>% count(s3classes)
hsls_small %>% count(s3classes) %>% as_factor()

hsls_small %>% count(s3clglvl)
hsls_small %>% count(s3clglvl) %>% as_factor()

```
### Creating analysis variables in the presence of skip patterns

Step 1b: Investigate relationship between input variables
```{r, results="hide"}
#x3sqstate and s3classes
hsls_small %>% group_by(x3sqstat) %>% count(s3classes) 
hsls_small %>% group_by(x3sqstat) %>% count(s3classes) %>% as_factor()

hsls_small %>% filter(x3sqstat==8) %>% count(s3classes)
hsls_small %>% filter(x3sqstat==8) %>% count(s3classes==-8)
hsls_small %>% filter(x3sqstat !=8) %>% count(s3classes)

#x3sqstate, s3classes and s3clglvl
hsls_small %>% group_by(s3classes) %>% count(s3clglvl) 
hsls_small %>% group_by(s3classes) %>% count(s3clglvl) %>% as_factor()

#add filter for whether student did not respond to X3 questionnaire
hsls_small %>% filter(x3sqstat==8) %>% group_by(s3classes) %>% count(s3clglvl) 
hsls_small %>% filter(x3sqstat !=8) %>% group_by(s3classes) %>% count(s3clglvl)

#add filter for s3classes is "missing" [-9]
hsls_small %>% filter(x3sqstat !=8,s3classes==-9) %>% group_by(s3classes) %>% count(s3clglvl)
hsls_small %>% filter(x3sqstat !=8,s3classes!=-9) %>% group_by(s3classes) %>% count(s3clglvl)

#add filter for s3classes equal to "no" or "don't know"
hsls_small %>% filter(x3sqstat !=8,s3classes!=-9, s3classes %in% c(2,3)) %>% group_by(s3classes) %>% count(s3clglvl)
hsls_small %>% filter(x3sqstat !=8,s3classes!=-9, s3classes %in% c(2,3)) %>% group_by(s3classes) %>% count(s3clglvl) %>% as_factor()

hsls_small %>% filter(x3sqstat !=8,s3classes!=-9, s3classes==1) %>% group_by(s3classes) %>% count(s3clglvl)
hsls_small %>% filter(x3sqstat !=8,s3classes!=-9, s3classes==1) %>% group_by(s3classes) %>% count(s3clglvl) %>% as_factor()
```

# Brainstorm next assignment: create GPA from course-level data

### Brainstorm in your homework groups for next assignment

Assignment: create GPA variables from student-course level data

- Link to assignment HERE

Data source: [National Longitudinal Study of 1972 (NLS72)](https://nces.ed.gov/surveys/nls72/)

- Follows 12th graders from 1972
- Data collection waves
    - Base year: 1972
    - Follow-up surveys in:  1973, 1974, 1976, 1979, 1986
    - Postsecondary transcripts collected in 1984
- Why use such an old survey for this assignment?
    - NLS72 predates data privacy agreements so postsecondary transcript data are publicly available
    
```{r}
#LOAD DATA
```
Work on the following in your homework groups:

- Read assignment
- Conduct EDA investigations of input data
    - For homework assignment, you only need to focus on these variables [and can ignore the others]
- Develop a plan for how you will go about creating GPA variables

### Brainstorm in your homework groups for next assignment

PUT CODE FOR EDA INVESTIGATIONS OF NLS72 HERE? OR PUT LINK TO .R SCRIPT W/ NLS EDA INVESTIGATIONS HERE?



